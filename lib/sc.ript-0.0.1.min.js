(function(){var t,e,n,i,r,o,s,u,h,l,a,c,f=[].slice,p=function(t,e){return function(){return t.apply(e,arguments)}},d={}.hasOwnProperty,_=function(t,e){function n(){this.constructor=t}for(var i in e)d.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=function(){function t(){}return t.loadData=function(t,e,n){var i,r,o;if(null==e&&(e="get"),null==n&&(n=""),i=new Deferred,null!=window.ActiveXObject)try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(s){r=s;try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(s){throw r=s,new TypeError("doesn't support XMLHttpRequest")}}else{if(!window.XMLHttpRequest)throw new TypeError("doesn't support XMLHttpRequest");o=new XMLHttpRequest}return o.onerror=function(t){return i.fail(t)},o.onreadystatechange=function(){return 4===o.readyState?i.call(o.responseText):void 0},o.open(e,t,!0),o.send(n),i},t.loadImage=function(t){var e,n;return e=new Deferred,n=new Image,n.onerror=function(t){return e.fail(t)},n.onload=function(){return e.call(n)},n.src=t,e},t.loadFile=function(t){var e,n;return e=new Deferred,n=new FileReader,n.onerror=function(t){return e.fail(t)},n.onload=function(){return e.call(n.result)},n.readAsDataURL(t),e},t}(),t=function(){function t(t){this.canvas=t,this.context=this.canvas.getContext("2d")}return t.prototype.width=function(t){return null==t?this.canvas.width:this.canvas.width=t},t.prototype.height=function(t){return null==t?this.canvas.height:this.canvas.height=t},t.prototype.clear=function(){return this.canvas.width=this.canvas.width},t.prototype.draw=function(t){return this.context.drawImage(t,0,0)},t.prototype.drawAt=function(t,e){return this.context.drawImage(t,e.x,e.y)},t.prototype.drawTo=function(t,e){return this.context.drawImage(t,e.x,e.y,e.width,e.height)},t.prototype.drawFromTo=function(t,e,n){return this.context.drawImage(t,e.x,e.y,e.width,e.height,n.x,n.y,n.width,n.height)},t.prototype.encodeAsPNG=function(){return this.canvas.toDataURL("image/jpeg")},t.prototype.encodeAsJPG=function(t){return null==t&&(t=.8),this.canvas.toDataURL("image/jpeg",t)},t}(),i=function(){function t(t,e){this.type=t,this.data=e}return t}(),r=function(){function t(){this._receivers={}}return t.prototype.on=function(t,e,n,i){var r,o,s;if(null==n&&(n=!1),null==i&&(i=0),"function"!=typeof e)throw new TypeError("listener is't Function");for(null==this._receivers[t]&&(this._receivers[t]=[]),s=this._receivers[t],r=s.length;r--;)if(o=reveicers[r],o.listener===e)return this;return s.push({listener:e,useCapture:n,priority:i}),s.sort(function(t,e){return e.priority-t.priority}),this},t.prototype.off=function(t,e){var n,i;if(i=this._receivers[t],!i)return this;for(n=i.length;n--;)i[n].listener===e&&i.splice(n,1),0===i.length&&delete this._receivers[t];return this},t.prototype.emit=function(t){var e,n,i,r,o,s=this;if(n=this._receivers[t.type],null==n)return this;for(t.currentTarget=this,i=function(e){return setTimeout(function(){return t._isPropagationStoppedImmediately?void 0:e.listener.call(s,t)},0)},r=0,o=n.length;o>r;r++)e=n[r],i(e);return this},t}(),s=function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.equals=function(t,e){return t.x===e.x&&t.y===e.y},t.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},t.angle=function(t,e){return e.subtract(t).angle()},t.distance=function(t,e){return e.subtract(t).length()},t.interpolate=function(t,e,n){return t.add(e.subtract(t).multiply(n))},t.prototype.angle=function(t){var e;return null==t?Math.atan2(this.y,this.x):(e=this.length(),this.x=e*Math.cos(t),this.y=e*Math.sin(t))},t.prototype.length=function(t){var e;return null==t?Math.sqrt(this.x*this.x+this.y*this.y):(e=this.angle(),this.x=t*Math.cos(e),this.y=t*Math.sin(e))},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.multiply=function(e){return new t(this.x*e,this.y*e)},t.prototype.divide=function(e){return new t(this.x/e,this.y/e)},t}(),u=function(){function t(t,e,n,i){this.x=null!=t?t:0,this.y=null!=e?e:0,this.width=null!=n?n:0,this.height=null!=i?i:0}return t}(),l=function(){function t(){}return t.join=function(){var e,n,i,r,o;for(i=arguments.length>=1?f.call(arguments,0):[],i=i.join("/").replace(/\/{2,}/g,"/").split("/"),n=[],r=0,o=i.length;o>r;r++)switch(t=i[r]){case".":break;case"..":e=n[n.length-1],null!=e&&".."!==e?n.pop():n.push(t);break;default:n.push(t)}return n.join("/")},t}(),o=function(){function t(){}return t.RADIAN_PER_DEGREE=Math.PI/180,t.DEGREE_PER_RADIAN=180/Math.PI,t.KB=1024,t.MB=t.KB*t.KB,t.GB=t.MB*t.KB,t.TB=t.GB*t.KB,t.degree=function(t){return t*this.DEGREE_PER_RADIAN},t.radian=function(t){return t*this.RADIAN_PER_DEGREE},t.signify=function(t,e){var n;return n=Math.pow(10,e),(t*n>>0)/n},t.kb=function(t){return t/this.KB},t.mb=function(t){return t/this.MB},t.random=function(t,e){return t+(e-t)*Math.random()},t}(),e=function(t){function e(t,n,i){var r,o,s,u,h,l,a,c,f,d,_,v,y,m,g;if(this.$elem=t,this.postfixes=n,this.recursive=null!=i?i:!1,this._onClick=p(this._onClick,this),this._onMouseUp=p(this._onMouseUp,this),this._onMouseDown=p(this._onMouseDown,this),this._onMouseOver=p(this._onMouseOver,this),this._onMouseOut=p(this._onMouseOut,this),e.__super__.constructor.call(this),!((null!=(m=this.$elem)?m.length:void 0)>0))throw new TypeError("element isn't exist");null==this.postfixes&&(this.postfixes=e.defaultPostfixes),o="IMG"===this.$elem[0].nodeName?this.$elem:this.recursive?this.$elem.find("img"):this.$elem.children("img"),this._namePartsRegistry={},this._imgs=[],n=[],g=this.postfixes;for(h in g)a=g[h],n.push(a);for(d=0,v=o.length;v>d;d++)if(u=o[d],r=$(u),c=r.attr("src"),null!=c)for(s=_=0,y=n.length;y>_;s=++_)if(a=n[s],null!=a&&(l=c.match(RegExp("^(.*)"+a+"(\\.\\w+)$")),3===(null!=l?l.length:void 0))){this._namePartsRegistry[u]=l,f=n.slice(),f.splice(s,1),this._preload(l,f),this._imgs.push(r);break}this.$elem.on("click",this._onClick).on("mouseleave",this._onMouseOut).on("mouseenter",this._onMouseOver).on("mousedown",this._onMouseDown).on("mouseup",this._onMouseUp),this.enabled(!0)}return _(e,t),e.FULL={out:"_out",over:"_over",down:"_down",disabled:"_disabled"},e.DEFAULT={out:"_out",over:"_over"},e.TOUCH={out:"_out",disabled:"_disabled"},e.defaultPostfixes={out:"_out",over:"_over"},e.prototype.destruct=function(){return this.$elem.off("click",this._onClick).off("mouseleave",this._onMouseOut).off("mouseenter",this._onMouseOver).off("mousedown",this._onMouseDown).off("mouseup",this._onMouseUp),delete this.$elem,delete this.postfixes,delete this.recursive,delete this._enabled,delete this._status,delete this._isMouseOver,delete this._namePartsRegistry,delete this._imgs},e.prototype.enabled=function(t){return null==t?this._enabled:this._enabled===t?this:(t?(this._enabled=t,this.$elem.css("cursor","pointer"),this._onMouseUp()):(this.$elem.css("cursor","default"),this._onMouseOut(),this.status("disabled"),this._enabled=t),this)},e.prototype.status=function(t){var e,n,i,r,o,s,u,h,l;if(null==t)return this._status;if(this._status===t)return this;if(i=this.postfixes[t],null==i)return this;for(this._status=t,h=this._imgs,l=[],s=0,u=h.length;u>s;s++)e=h[s],n=this._namePartsRegistry[e[0]],r=n[1]+i+n[2],o=e[0].vml,o?o.image.fill.setAttribute("src",r):l.push(e.attr("src",r));return l},e.prototype._preload=function(t,e){var n,i,r,o;for(o=[],i=0,r=e.length;r>i;i++)n=e[i],null!=n&&o.push($("<img>").attr("src",t[1]+n+t[2]));return o},e.prototype._onMouseOut=function(t){return this._isMouseOver=!1,this._enabled?(this.status("out"),t?this.emit(t):void 0):void 0},e.prototype._onMouseOver=function(t){return this._isMouseOver=!0,this._enabled?(this.status("over"),t?this.emit(t):void 0):void 0},e.prototype._onMouseDown=function(t){return this._enabled?(this.status("down"),t?this.emit(t):void 0):void 0},e.prototype._onMouseUp=function(t){return this._enabled?(this.status(this._isMouseOver?"over":"out"),t?this.emit(t):void 0):void 0},e.prototype._onClick=function(t){return this._enabled?t?this.emit(t):void 0:void 0},e}(r),c={sc:{ript:{deferred:{DLoader:n},display:{Bitmap:t},events:{Event:i,EventEmitter:r},geom:{Point:s,Rectangle:u},path:l,utils:{NumberUtil:o},ui:{Button:e}}}};for(h in c)a=c[h],window[h]=a}).call(this);